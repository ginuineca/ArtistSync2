# Railway Deployment Configuration
# https://railway.app/reference/deploying-a-dockerfile

[build]
builder = "DOCKERFILE"
dockerfilePath = "Dockerfile"
watchPatterns = ["**/*.js", "package.json"]

[deploy]
startCommand = "npm start"
healthcheckPath = "/health"
healthcheckTimeout = 300
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

[[services]]
name = "artistsync-api"

[[services.env]]
name = "PORT"
value = "5000"

[[services.env]]
name = "NODE_ENV"
value = "production"

# Database URL (will be set by Railway plugin)
[[services.env]]
name = "MONGODB_URI"
value = "${{MongoDB.MONGODB_URI}}"

# JWT Secrets (generate these in Railway dashboard)
[[services.env]]
name = "JWT_SECRET"
value = "your_jwt_secret_change_in_production"

[[services.env]]
name = "JWT_ACCESS_TOKEN_SECRET"
value = "your_access_token_secret"

[[services.env]]
name = "JWT_REFRESH_TOKEN_SECRET"
value = "your_refresh_token_secret"

[[services.env]]
name = "JWT_ACCESS_EXPIRES_IN"
value = "15m"

[[services.env]]
name = "JWT_REFRESH_EXPIRES_IN"
value = "7d"

# Frontend URL (update after deploying frontend)
[[services.env]]
name = "FRONTEND_URL"
value = "https://your-frontend-url.vercel.app"

[[services.env]]
name = "CORS_ORIGIN"
value = "https://your-frontend-url.vercel.app"

# File Upload
[[services.env]]
name = "MAX_FILE_SIZE"
value = "5242880"

# AWS S3 (optional - for production file storage)
[[services.env]]
name = "AWS_ACCESS_KEY_ID"
value = ""

[[services.env]]
name = "AWS_SECRET_ACCESS_KEY"
value = ""

[[services.env]]
name = "AWS_REGION"
value = "us-east-1"

[[services.env]]
name = "AWS_S3_BUCKET"
value = ""

# Redis (optional - for caching)
[[services.env]]
name = "REDIS_URL"
value = ""
